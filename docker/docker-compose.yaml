version: '2'
services:
    php-apache:
        image: php:${PHP_VERSION}-apache
        command: bash -c "if [ ! -d /usr/src/php/ext/pdo_mysql ];then docker-php-ext-install pdo pdo_mysql; fi;a2enmod rewrite;echo \"${PHP_OVERRIDE_STRING}\" | base64 --decode>${PHP_OVERRIDE_PATH};if [ ! -f /var/www/.env ];then cat /var/www/.env.example > /var/www/.env;echo -e \"\n \n#GENERATED BY DOCKER DO NOT CHANGE \n\" >> /var/www/.env; echo \"DB_HOST=${DB_HOST}\" >> /var/www/.env; echo \"DB_DATABASE=${DB_DATABASE}\" >> /var/www/.env; echo \"DB_USERNAME=${DB_USERNAME}\" >> /var/www/.env; echo \"DB_PASSWORD=${DB_PASSWORD}\" >> /var/www/.env; echo \"DB_CONNECTION=mysql\" >> /var/www/.env; echo \"DB_PORT=${DB_PORT}\" >> /var/www/.env; fi; apache2-foreground"
        ports:
            - ${WEB_PORT}:80
        volumes:
            - ${WEB_PATH}:/var/www
            - ${WEB_PATH}/public:/var/www/html
        links:
            - mariadb

    mariadb:
        image: mysql:${DB_VERSION}
        volumes:
            - mariadb_local:/var/lib/mysql
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: "no"
            MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
            MYSQL_USER: ${DB_USERNAME}
            MYSQL_PASSWORD: ${DB_PASSWORD}
            MYSQL_DATABASE: ${DB_DATABASE}

    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        environment:
            PMA_ARBITRARY: 0
            MYSQL_USER: ${DB_USERNAME}
            MYSQL_PASSWORD: ${DB_PASSWORD}
            MYSQL_ROOT_PASSWORD: ${DB_ROOT_PASSWORD}
            PMA_HOST: mariadb
            PMA_PORT: 3306
            PMA_USER: root
            PMA_PASSWORD: ${DB_ROOT_PASSWORD}
        ports:
            - ${ADMIN_PORT}:80
        links:
            # for mysql container
            - mariadb:db
volumes:
    mariadb_local: